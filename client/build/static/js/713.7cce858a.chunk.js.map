{"version":3,"file":"static/js/713.7cce858a.chunk.js","mappings":"4LAeO,MAAMA,EAAmBC,UAA4B,IAArB,QAACC,EAAO,OAAEC,GAAOC,EACpD,MAAMC,EAAaF,EAAOE,WACpBC,QAAiBJ,EAAQI,WACzBC,EAAG,QAAAC,OAAWH,EAAU,KAAAG,OAAIL,EAAOM,IAEnCC,QAAiBC,MAAMJ,EAAK,CAC9BK,OAAQ,SACRC,QAAS,CAAC,eAAgB,oBAC1BC,KAAMC,KAAKC,UAAU,CAACC,OAAQX,EAASY,IAAI,cAG/C,IAAIR,EAASS,GAAG,CAEZ,MAAO,CAACC,aADmBV,EAASW,QACRC,QAEhC,CAEA,OAAOC,EAAAA,EAAAA,IAAS,IAADf,OAAKH,GAAa,EAKxBmB,EAAavB,UAA4B,IAArB,QAACC,EAAO,OAAEC,GAAOsB,EAC9C,MAAMb,EAASV,EAAQU,OACjBP,EAAaF,EAAOE,WAGpBqB,EAtCV,SAA8BC,GAC1B,MAAMC,EAAQ,CAAC,EAMf,OALAC,OAAOC,KAAKH,GAAKI,SAAQC,IAClBL,EAAIK,IAAQL,EAAIK,GAAKC,OAAO,IAC3BL,EAAOI,GAAML,EAAIK,GACrB,IAEGJ,CACX,CA8BwBM,CADPL,OAAOM,kBAAkBjC,EAAQI,aAG9C,IAAIC,EAAG,QAAAC,OAAWH,GACJ,UAAXO,IACCL,GAAG,IAAAC,OAAQL,EAAOM,KAEtB,MAAMC,QAAiBC,MAAMJ,EAAK,CAC9BK,OAAQA,EACRC,QAAS,CAAC,eAAgB,oBAC1BC,KAAMC,KAAKC,UAAUU,KAGnBU,QAAqB1B,EAASW,OAEpC,IAAIX,EAASS,GACT,MAAO,CAACC,MAAOgB,EAAad,SAAW,wBAE3C,IAAIe,EAAW,IAAA7B,OAAOH,GAOtB,OALIgC,GAAW,IAAA7B,OADD,UAAXI,EACoBT,EAAOM,GAEP2B,EAAaE,QAG7Bf,EAAAA,EAAAA,IAASc,EAAY,EAKnBE,EAAmBtC,UAA2B,IAArB,QAACC,EAAO,OAAEC,GAAOqC,EACnD,MAAM1B,EAAOe,OAAOM,kBAAkBjC,EAAQI,YAC9CQ,EAAK2B,MAAQtC,EAAOM,GAEpB,MAAMC,QAAiBC,MAAM,gBAAiB,CAC1CC,OAAQ,OACRC,QAAS,CAAC,eAAgB,oBAC1BC,KAAMC,KAAKC,UAAUF,KAGnBsB,QAAqB1B,EAASW,OAEpC,OAAIX,EAASS,GAGN,CAACuB,QAAS,4GAFN,CAACtB,MAAOgB,EAAad,SAAW,uBAEJ,C","sources":["utils/actions.jsx"],"sourcesContent":["import {redirect} from 'react-router-dom'\r\n\r\n\r\n//return the body obj only with the fields which were actually updated\r\nfunction clearUndefinedFields(obj){\r\n    const newObj ={}\r\n    Object.keys(obj).forEach(key=>{\r\n        if(obj[key] && obj[key].length>0){\r\n            newObj[key]= obj[key]\r\n        }\r\n    })\r\n    return newObj\r\n}\r\n\r\n//deleting a book/story\r\nexport const deleteItemAction = async ({request, params})=>{\r\n    const collection = params.collection\r\n    const formData = await request.formData()\r\n    const url = `/api/${collection}/${params.id}`\r\n\r\n    const response = await fetch(url, {\r\n        method: \"DELETE\",\r\n        headers: {'Content-Type': 'application/json'},\r\n        body: JSON.stringify({secret: formData.get(\"secret\")})\r\n    })\r\n\r\n    if(!response.ok){\r\n        const responseData = await response.json()\r\n        return {error: responseData.message}\r\n        // throw json({message: responseData.message}, {status: response.status})\r\n    }\r\n\r\n    return redirect(`/${collection}`)\r\n\r\n}\r\n\r\n//creating or updating a book/story\r\nexport const itemAction = async ({request, params})=>{\r\n    const method = request.method\r\n    const collection = params.collection\r\n    \r\n    const body = Object.fromEntries(await request.formData());\r\n    const bookDataObj = clearUndefinedFields(body)\r\n\r\n    let url = `/api/${collection}`\r\n    if(method === \"PATCH\"){\r\n        url += `/${params.id}`\r\n    }\r\n    const response = await fetch(url, {\r\n        method: method,\r\n        headers: {'Content-Type': 'application/json'},\r\n        body: JSON.stringify(bookDataObj)\r\n    })\r\n\r\n    const responseData = await response.json()\r\n\r\n    if(!response.ok){\r\n        return {error: responseData.message || \"something went wrong\"}\r\n    }\r\n    let redirectUrl = `/${collection}`\r\n    if(method === \"PATCH\"){\r\n        redirectUrl += `/${params.id}`\r\n    }else{\r\n        redirectUrl += `/${responseData.docId}`\r\n    }\r\n\r\n    return redirect(redirectUrl)\r\n}\r\n\r\n\r\n//adding a comment\r\nexport const addCommentAction = async({request, params})=>{\r\n    const body = Object.fromEntries(await request.formData());\r\n    body.story = params.id\r\n\r\n    const response = await fetch(\"/api/comments\", {\r\n        method: \"POST\",\r\n        headers: {'Content-Type': 'application/json'},\r\n        body: JSON.stringify(body)\r\n    })\r\n\r\n    const responseData = await response.json()\r\n\r\n    if(!response.ok){\r\n        return {error: responseData.message || \"something went wrong\"}\r\n    }\r\n    return {success: \"התגובה נוספה בהצלחה\"}\r\n}"],"names":["deleteItemAction","async","request","params","_ref","collection","formData","url","concat","id","response","fetch","method","headers","body","JSON","stringify","secret","get","ok","error","json","message","redirect","itemAction","_ref2","bookDataObj","obj","newObj","Object","keys","forEach","key","length","clearUndefinedFields","fromEntries","responseData","redirectUrl","docId","addCommentAction","_ref3","story","success"],"sourceRoot":""}